<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="pretty-atom-feed.xsl" type="text/xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
  <title>Blog Title</title>
  <subtitle>This is a longer description about your blog.</subtitle>
  <link href="https://example.com/eleventy-base-blog/feed/feed.xml" rel="self" />
  <link href="https://example.com/eleventy-base-blog/" />
  <updated>2024-12-28T00:00:00Z</updated>
  <id>https://example.com/eleventy-base-blog/</id>
  <author>
    <name>Your Name</name>
  </author>
  <entry>
    <title>Writing an OpenAI powered app to practice my Spanish skills</title>
    <link href="https://example.com/eleventy-base-blog/blog/spanish_translation/" />
    <updated>2024-12-28T00:00:00Z</updated>
    <id>https://example.com/eleventy-base-blog/blog/spanish_translation/</id>
    <content type="html">&lt;p&gt;I have been learning Spanish for a year now. Like many others, I find that while I am quite good at reading, my active writing and speaking skills remain fairly basic. To address this gap, I developed a small application that generates random sentences for me to translate into Spanish. With the help of OpenAI, I can translate these sentences and receive corrections, making the process both interactive and effective.&lt;/p&gt;
&lt;h1 id=&quot;concept&quot;&gt;Concept&lt;/h1&gt;
&lt;p&gt;An app isn&#39;t strictly necessary for this purpose—anyone can use ChatGPT to generate sentences and then ask it to correct their translations. However, I wanted to streamline this process for a few key reasons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It’s more useful to practice translations that we&#39;ve already done, rather than always translating new sentences. With long-term use, this requirement becomes difficult to fulfill with solely relying on ChatGPT.&lt;/li&gt;
&lt;li&gt;Interaction with ChatGPT typically happens through typed requests. When it corrects a translation, it often provides explanations in its response. However, when everything is included in a single response, it can become overwhelming. With a custom UI, we can hide the explanations and reveal them by clicking a button.&lt;/li&gt;
&lt;li&gt;I’ve found that OpenAI’s random sentence generation isn’t entirely random. After a few iterations, it tends to recycle the same topics and phrases. I’ve found it more effective to randomize several parameters in code and feed them into the OpenAI prompt.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;setup&quot;&gt;Setup&lt;/h1&gt;
&lt;p&gt;I wrote the app using TypeScript and ReactJS, and it’s deployed on fly.io. All translations are stored in a SQLite database, along with the number of times I’ve provided a correct translation. This helps during practice by adjusting the probability of seeing a sentence again. This was my first time using fly.io, and I’m quite satisfied with it. I needed a simple, cost-effective platform to deploy my code, and it fits this need perfectly.&lt;/p&gt;
&lt;h1 id=&quot;challenges&quot;&gt;Challenges&lt;/h1&gt;
&lt;h2 id=&quot;1-flaky-corrections&quot;&gt;1. Flaky corrections&lt;/h2&gt;
&lt;p&gt;Initially, I asked OpenAI to correct the sentence and provide a list of explanations. This worked in most cases, but there was one annoying issue:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;I translate a sentence.&lt;/li&gt;
&lt;li&gt;It corrects my translation and provides an explanation of why it’s incorrect.&lt;/li&gt;
&lt;li&gt;Later, when translating the same sentence, I provide the corrected translation it gave me earlier.&lt;/li&gt;
&lt;li&gt;It corrects it again, usually switching some words with synonyms and claiming that they fit the context better.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;After struggling with this issue for a while, I tried refining the prompt by adding the following additional commands:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;quot;Focus only on major errors that affect meaning, and ignore minor stylistic differences or words that only have a slightly different meaning.&amp;quot;&lt;/li&gt;
&lt;li&gt;&amp;quot;Be relaxed and non-critical in evaluating the Spanish translation.&amp;quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However, it seemed to ignore many of these adjustments and still had a tendency to make corrections, even when the issue was simply with synonyms.&lt;/p&gt;
&lt;p&gt;It took me some time to realize that the process works much better if I split it into two tasks:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;One prompt to provide the correction and a list of explanations.&lt;/li&gt;
&lt;li&gt;Another prompt to ask a simple question: Is the translation correct at all?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If the answer to &amp;quot;Is the translation correct?&amp;quot; is yes, there’s no need to show the output from the other prompt with more detailed corrections.&lt;/p&gt;
&lt;p&gt;Since then, I’ve read the prompt engineering guide from OpenAI and discovered that they offer similar advice &lt;a href=&quot;https://platform.openai.com/docs/guides/prompt-engineering#strategy-split-complex-tasks-into-simpler-subtasks&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&quot;2-random-sentences&quot;&gt;2. Random sentences&lt;/h2&gt;
&lt;p&gt;I went through several iterations when it came to generating random sentences for translation practice. Initially, the prompt was quite simple: &amp;quot;Generate a random beginner-level sentence for translation.&amp;quot; However, the responses were often very similar, mostly revolving around students and their homework, and lacking some verb tenses I wanted to practice. Eventually, I decided to parameterize the prompt and generate random values for the following parameters using my code:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Mood: indicative, question, imperative, etc.&lt;/li&gt;
&lt;li&gt;Tense: past, present, future&lt;/li&gt;
&lt;li&gt;Word: a word that must be included in the sentence. I ended up using a list of &amp;quot;The 1000 most common English words&amp;quot; and randomly selecting one each time.&lt;/li&gt;
&lt;li&gt;Topic: science, politics, religion, etc.&lt;/li&gt;
&lt;/ul&gt;
</content>
  </entry>
  <entry>
    <title>Modeling a grass field in three.js</title>
    <link href="https://example.com/eleventy-base-blog/blog/grassfield/" />
    <updated>2016-10-22T00:00:00Z</updated>
    <id>https://example.com/eleventy-base-blog/blog/grassfield/</id>
    <content type="html">&lt;script src=&quot;https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;
&lt;p&gt;&lt;a href=&quot;https://petoalbert.github.io/flora&quot;&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/gHQL7E1DSJ-1366.avif 1366w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/gHQL7E1DSJ-1366.webp 1366w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://example.com/eleventy-base-blog/blog/grassfield/gHQL7E1DSJ-1366.png&quot; alt=&quot;screenshot&quot; width=&quot;1366&quot; height=&quot;768&quot;&gt;&lt;/picture&gt;&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This post is about a three.js based application which shows a grass fild with
wind blowing in it. You can try it out in your browser &lt;a href=&quot;https://petoalbert.github.io/flora&quot;&gt;here&lt;/a&gt;. The source
code is on &lt;a href=&quot;https://github.com/petoalbert/flora&quot;&gt;github&lt;/a&gt;. Here I will give a brief description about some of
the techniques which I have used in the application. A lot of things
are left out, but I plan to add them later to the post. Although the post is not
meant to be a comprehensive tutorial, please read further if you are interested
in the details of my work.&lt;/p&gt;
&lt;p&gt;On part of the reader, I will assume a basic understanding of OpenGL and how a
shader works.&lt;/p&gt;
&lt;h2 id=&quot;a-blade-of-grass&quot;&gt;A blade of grass&lt;/h2&gt;
&lt;p&gt;The javascript code loads an &lt;code&gt;.obj&lt;/code&gt; file containing the vertices of a 2D blade
of grass, exported from a Blender model. The application uses the object loader
from a three.js &lt;a href=&quot;https://threejs.org/examples/#webgl_loader_obj&quot;&gt;example&lt;/a&gt;. In the loaded model,
the alignment is assumed to be the following: the z axis is always zero
(i.e. the blade is in the x-y plane), and
the longitudinal axis is y, with the bottom of the grass having 0 value for
the y coordinate.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/LpihAILE_A-1366.avif 1366w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/LpihAILE_A-1366.webp 1366w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://example.com/eleventy-base-blog/blog/grassfield/LpihAILE_A-1366.png&quot; alt=&quot;grass in blender&quot; width=&quot;1366&quot; height=&quot;768&quot;&gt;&lt;/picture&gt;
&lt;h2 id=&quot;instancing&quot;&gt;Instancing&lt;/h2&gt;
&lt;p&gt;Once the application has loaded the blade vertices, it needs to draw a lot of
them. The naive solution would be to make a &lt;a href=&quot;https://threejs.org/docs/index.html#Reference/Objects/Mesh&quot;&gt;THREE.Mesh&lt;/a&gt; with the
same vertices for each blade of grass, add each one to the scene and then
make them unique by changing there position and appearance. This, however, would
result in a very slow code if we really wanted to draw a lot of pieces, because
each piece would need a separate rendering call.&lt;/p&gt;
&lt;p&gt;We can overcome this problem with instancing, which basically means that we
only use one rendering call for all of the pieces. Since every blade of grass
is based on the same vertices, those only need to be defined once, and the GPU
will use them for each blade. On the other hand, we have to associate some
unique values with each blade (rotation, position, color, etc.), so that the
geometry shader can produce different vertices and the fragment shader can
produce different colors. These values will be stored in
&lt;code&gt;THREE.InstancedBufferAttribute&lt;/code&gt; objects. If you would like to read more about
OpenGL instancing, read this &lt;a href=&quot;http://learnopengl.com/#!Advanced-OpenGL/Instancing&quot;&gt;great article&lt;/a&gt;, or have a look
at this &lt;a href=&quot;https://threejs.org/examples/#webgl_buffergeometry_instancing&quot;&gt;three.js example&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;From now on, please keep in mind, that we have to use the shaders for for
every kind of transformation, beacuse the rendering loop for every blade
begins with the same set of vertices. For example, if we want to bend a specific
blade of grass in a given way, we can&#39;t just transform the vertices in the
javascript code, because that would affect every other blade of grass. We have
to do that in the shader, too.&lt;/p&gt;
&lt;p&gt;To make each blade of grass look different, I have used the following
transformations in the geometry shader (i.e. on each vertex of a blade of
grass), in the following order:&lt;/p&gt;
&lt;h3 id=&quot;1-scaling-the-width-and-height&quot;&gt;1. Scaling the width and height&lt;/h3&gt;
&lt;h3 id=&quot;2-bending-the-grass-piece&quot;&gt;2. Bending the grass piece&lt;/h3&gt;
&lt;p&gt;This could be done in many ways. Don&#39;t forget that
when the geometry shader is working on a vertex, it doesn&#39;t know anything
about the other vertices of the blade of grass, so in a mathematical sense
we can only use a function &#92;(f(v,a,u)&#92;) to calculate the transformed vertex,
where the v,a,u arguments are the actual vertex, the attributes of the
current blade of grass, and uniforms.&lt;/p&gt;
&lt;p&gt;In my model, every blade has a constant
curvature, i.e. its y and z coordinates fit on a circular arc, which is
calculated like this in the shader (simplified version):&lt;/p&gt;
&lt;pre class=&quot;language-glsl&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// curve is different for each blade of grass and describes the curvature&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// r is the radius of the circular arc&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// len is the height of the grass piece&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; len&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;curve&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; angle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vPosition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
vPosition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;z &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;angle&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;r&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
vPosition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;angle&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The shader uses the mathematical identity &#92;(&#92;theta = s/r&#92;), for a circular
arc of length &#92;(s&#92;) and radius &#92;(r&#92;), where &#92;(&#92;theta&#92;) is the subtended angle
in radians.
For a vertex of a given blade of grass, &#92;(s&#92;) is the &#92;(y&#92;) coordinate of the
vertex, and &#92;(r&#92;) is constant to the whole blade. The below picture shows
arcs with the same length, but with different radius, in red:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/NcVuMqVEEo-756.avif 756w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/NcVuMqVEEo-756.webp 756w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; class=&quot;center&quot; width=&quot;756&quot; src=&quot;https://example.com/eleventy-base-blog/blog/grassfield/NcVuMqVEEo-756.png&quot; alt=&quot;curvature&quot; height=&quot;756&quot;&gt;&lt;/picture&gt;
&lt;h3 id=&quot;3-rotating-the-blade-along-the-y-axis&quot;&gt;3. Rotating the blade along the y axis&lt;/h3&gt;
&lt;h3 id=&quot;4-translating-the-blade-in-the-x-z-plane&quot;&gt;4. Translating the blade in the x-z plane&lt;/h3&gt;
&lt;p&gt;Besides the geometry transformations, each blade has a slightly different color,
which is set in the fragment shader.&lt;/p&gt;
&lt;h2 id=&quot;wind&quot;&gt;Wind&lt;/h2&gt;
&lt;p&gt;To make each piece look more realistic, we need to add some movement to them,
which, in the case of this application, consist of two parts: constant movement
and gusts of wind.&lt;/p&gt;
&lt;p&gt;In both cases, the movement is present by changing the curvature of the
blade with respect to time. This is accomplished by extending the
&lt;a href=&quot;https://example.com/eleventy-base-blog/blog/grassfield/#bending-the-grass-piece&quot;&gt;previously presented snippet&lt;/a&gt; from the geometry
shader:&lt;/p&gt;
&lt;pre class=&quot;language-glsl&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// curve is different for each blade of grass and describes the curvature&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// r is the radius of the circular arc&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// len is the height of the grass piece&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; len&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;curve&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;windEffects&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// notice that we added windEffects&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; angle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; vPosition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
vPosition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;z &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;angle&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;r&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
vPosition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;angle&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;constant-movement&quot;&gt;Constant movement&lt;/h3&gt;
&lt;p&gt;This movement is a very low-amplitude movement, but even this little movement
helps get a more natural feel, where not everything is 100% static.
Each blade will have a different amplitude and frequency, to make
it look natural and not too synchronized.&lt;/p&gt;
&lt;pre class=&quot;language-glsl&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// amplitude and freq are unique for each blade of grass&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; len&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;curve&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;amplitude&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;freq&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id=&quot;wind-gust&quot;&gt;Wind gust&lt;/h3&gt;
&lt;p&gt;The scene also has short-term wind gusts, about which we have the following
assumptions:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;A wind gust has the same direction everywhere and is parallel to the
x-z (horizontal) plane&lt;/li&gt;
&lt;li&gt;A gust has its effects for a finite amount of time, and has a starting point
and starting time. These assumptions are needed because we only want to
model the gust near the &amp;quot;player&#39;s&amp;quot; position.&lt;/li&gt;
&lt;li&gt;A gust has a speed, which is the same everywhere&lt;/li&gt;
&lt;li&gt;A wind gust is only in effect for a finite amount of time, and there can
only be one active wind gust at any time.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;For every point in the OpenGL space, the shader needs to know when the blow
will reach that point, or if it has reached that.
Depending on this state, the shader will derive the strength of the gust,
which will gradually increase until the gust reaches that point, and will
gradually decrease after. It is also important for the movement to start
and end slowly, otherwise it may look unnatural. Taking into account these
criteria, I have chosen the &lt;a href=&quot;https://en.wikipedia.org/wiki/Gaussian_function&quot;&gt;gaussian function&lt;/a&gt;.&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/RbSdTl-elU-800.avif 800w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/RbSdTl-elU-800.webp 800w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; class=&quot;center&quot; width=&quot;800&quot; src=&quot;https://example.com/eleventy-base-blog/blog/grassfield/RbSdTl-elU-800.png&quot; alt=&quot;gaussian&quot; height=&quot;600&quot;&gt;&lt;/picture&gt;
&lt;p&gt;The above picture shows a basic implementation of the gust strength at a
given point. However, I think that the settling phase can usually last longer
and contain some spring-like back-and-forth movement, so I made it longer and
multiplied it with a cosine function:&lt;/p&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/atI0v4EgqM-800.avif 800w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://example.com/eleventy-base-blog/blog/grassfield/atI0v4EgqM-800.webp 800w&quot;&gt;&lt;img loading=&quot;lazy&quot; decoding=&quot;async&quot; class=&quot;center&quot; width=&quot;800&quot; src=&quot;https://example.com/eleventy-base-blog/blog/grassfield/atI0v4EgqM-800.png&quot; alt=&quot;modified gaussian&quot; height=&quot;600&quot;&gt;&lt;/picture&gt;
&lt;p&gt;This is the simplified part of the geometry shader that computes the wind strength:&lt;/p&gt;
&lt;pre class=&quot;language-glsl&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// The transitional stage is governed by one half of a Gaussian function,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// while the maximum deflection stage is constant (-1.0 or 1.0)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; windRiseTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;windRiseTime&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;spread&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;windRiseTime&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; t&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;windRiseTime&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;len&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Do a little more than a half cosine in the settling phase&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.55&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;PI&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;windSettlingTime&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;f&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;exp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;settlingSpread&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;!--* this is only used to correct syntax highlighting in the editor--&gt;
&lt;p&gt;Another important thing is the blade&#39;s rotation about its longitudinal (y) axis.
If it does not align with the gust direction, then, besides the bending,
the gust will also rotate the piece:&lt;/p&gt;
&lt;pre class=&quot;language-glsl&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/*
 * Return the angle to which the wind in its strongest state will rotate
 * the tip of the grass piece.
 */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;rotateInWind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// The angle difference in the wind direction and the blade&#39;s rotation&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; diff &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;angleDiff&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// The wind never rotates more than 90 degrees&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;diff &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;PI&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; diff &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;PI&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    diff &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; PI&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;diff&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;diff &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;PI &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; diff &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3.0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;PI&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    diff &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; PI&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;diff&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;diff &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3.0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;PI&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    diff &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;PI&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;diff&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// The lowest height on the grass piece at which it can twist&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; twistHeight &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; unitHeight&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// The amount that this vertex will twist&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; twistCoefficient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;position&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;twistHeight&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;unitHeight&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;position&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;y &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; twistHeight&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;twistCoefficient &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; diff&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;twistCoefficient&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; diff&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Finally, the blade&#39;s curvature is modified according to the following line:&lt;/p&gt;
&lt;pre class=&quot;language-glsl&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// the weighting 0.5 is experimentally determined&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; len&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;curve&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;windStrength&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;amplitude&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;freq&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Here, I have left out the details of how the wind travels throght the field,
i.e. how the position influences the arguments of the gaussian curve.&lt;/p&gt;
&lt;h2 id=&quot;making-the-field-infinite&quot;&gt;Making the field infinite&lt;/h2&gt;
&lt;p&gt;The last thing is to be able to move in the grass. The code for the controls
(WASD + mouse) is reused from a &lt;a href=&quot;https://threejs.org/examples/#misc_controls_pointerlock&quot;&gt;three.js example&lt;/a&gt;, so I
will not write about them.&lt;/p&gt;
&lt;p&gt;The more important problem from our perspective is to always draw the blades
of grass around the &amp;quot;player&#39;s&amp;quot; current position, so that the field looks
infinite. I will note here that the original blade&#39;s are spread out around
the &#92;((0,0)&#92;) point in the x-z plane in a square shape, with width &#92;(a&#92;).
Now, if the player&#39;s position in the x-z plane is &#92;((p_x,p_z)&#92;), we have to
draw the pieces in a square with width &#92;(a&#92;), centered at &#92;((p_x,p_z)&#92;).
We suppose that the player can&#39;t see further than &#92;(a/2&#92;) distance, because
there is fog.&lt;/p&gt;
&lt;p&gt;The problem is solved in the geometry shader: if a blade in its original
position can&#39;t be seen from the players position (its distance is more than
&#92;(a/2&#92;)), we translate the blade in the x-z plane by
&#92;((t_x&#92;cdot a,t_z &#92;cdot a)&#92;) to the square centered around the player&#39;s
position, where &#92;(t_x&#92;) and &#92;(t_z&#92;) are appropiate integers:&lt;/p&gt;
&lt;pre class=&quot;language-glsl&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-glsl&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/*
 * Offset the grass piece with integer multiples of spread in the x and z directions
 * to be in the near the players current position.
 */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;calculateViewOffset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;vec3&lt;/span&gt; playerPositionInPlane &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;vec3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;playerPosition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;playerPosition&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;z&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;vec3&lt;/span&gt; diff &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; playerPositionInPlane &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  viewOffset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;float&lt;/span&gt; dlen &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;diff&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// spread is the side of the square in which the blades are laid out&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dlen &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; spread&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    viewOffset&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;diff&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;x&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;spread&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;spread&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    viewOffset&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;z &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;diff&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;z&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;spread&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;spread&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
</content>
  </entry>
</feed>